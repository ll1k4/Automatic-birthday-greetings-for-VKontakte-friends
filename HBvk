import vk_api
import datetime

# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞
TOKEN = '–í–∞—à_—Ç–æ–∫–µ–Ω_–¥–æ—Å—Ç—É–ø–∞'

def get_birthdays(vk):
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
    friends = vk.friends.get(fields='bdate')['items']
    today = datetime.datetime.now().date()

    birthdays_today = []
    
    for friend in friends:
        if 'bdate' in friend:
            bdate = friend['bdate']
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ–Ω—å –∏ –º–µ—Å—è—Ü
            if len(bdate.split('.')) >= 3:  # –ï—Å–ª–∏ –µ—Å—Ç—å –≥–æ–¥
                day, month, year = map(int, bdate.split('.'))
            else:
                day, month = map(int, bdate.split('.'))
                year = None            
            if (today.day == day) and (today.month == month):
                birthdays_today.append(friend['id'])

    return birthdays_today

def send_congratulations(vk, friend_ids):
    for friend_id in friend_ids:
        message = "–° –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è! üéâ –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –±—É–¥–µ—Ç –ø–æ–ª–æ–Ω —Ä–∞–¥–æ—Å—Ç–∏ –∏ —É—Å–ø–µ—Ö–æ–≤!"
        vk.messages.send(user_id=friend_id, message=message, random_id=0)

def main():
    vk_session = vk_api.VkApi(token=TOKEN)
    vk = vk_session.get_api()

    birthdays_today = get_birthdays(vk)
    
    if birthdays_today:
        send_congratulations(vk, birthdays_today)
        print(f"–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã {len(birthdays_today)} –¥—Ä—É–∑—å—è–º —Å –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è!")
    else:
        print("–°–µ–≥–æ–¥–Ω—è –Ω–µ—Ç –¥–Ω–µ–π —Ä–æ–∂–¥–µ–Ω–∏—è —É –¥—Ä—É–∑–µ–π.")

if __name__ == '__main__':
    main()
